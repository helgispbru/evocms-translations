import{a as A,Q as R,d as U,R as I,S as q,r as f,e as C,i as z,o as x,k as D,h as o,g as G,V as S,A as b,t as n,j as e,m as _,W as V,X as O,Y as H,T as h,U as E}from"./index-sLDwdUli.js";const J={class:"row mb-1 align-items-center"},L={class:"col-8"},Q={class:"row mb-1 align-items-center"},W={class:"col-8"},X={key:0,class:"alert alert-success px-2 py-1",role:"alert"},Y={key:1,class:"alert alert-warning px-2 py-1",role:"alert"},K={class:"mt-3 text-end"},Z={class:"btn btn-primary mx-1",type:"submit"},ee={class:"btn btn-secondary mx-1",type:"reset"},te={__name:"group",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(M){const{t:s}=A(),N=R("locale"),m=U.useToast(),v=I(M,"modelValue"),c=q(),d=f(""),t=f(""),y=f(null),g=f(null),w=C(()=>{var r,a;return((a=(r=y.value)==null?void 0:r.meta)==null?void 0:a.valid)||!1}),F=C(()=>{var r,a;return((a=(r=g.value)==null?void 0:r.meta)==null?void 0:a.valid)||!1});async function P(r){if(t.value="",d.value="",c.data.action=="edit"&&Number(c.data.id)==0)return t.value=s("groups.form.error.noid"),m.warning(t.value,h),!1;const a=Object.assign({},c.data,r,{locale:N.value});let k="",T="";switch(a.action){case"add":k="POST",T=`${E}/groups`;break;case"edit":k="PUT",T=`${E}/groups/${a.id}`;break;default:return t.value=s("groups.form.error.noaction"),m.error(t.value,h),!1}try{const l={method:k,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},u=await fetch(T,l),i=await u.json();if(!u.ok){const B=(i==null?void 0:i.error)||`${u.status} ${u.statusText}`,{errors:p}=i;p.hasOwnProperty("code")&&y.value.setErrors(p.code),p.hasOwnProperty("title")&&g.value.setErrors(p.title);const $=new Error(B);throw $.status=u.status,$}d.value=i.message||"",t.value=i.error||"",v.value.data={saved:!0},v.value.action="close"}catch(l){throw l.name==="TypeError"?m.error(`${s("toast.errornetwork")} ${l.message}`,h):m.error(`${s("toast.error")} ${l.message}`,h),l}}function j(){t.value="",d.value="",v.value.data={saved:!1},v.value.action="close"}return(r,a)=>(x(),z(e(H),{onSubmit:P,onReset:j,class:"needs-validation",name:"GroupForm","initial-values":{code:e(c).data.code,title:e(c).data.title}},{default:D(()=>[o("div",J,[o("label",{class:b(["col-4 col-form-label",{"pb-4":!w.value}]),for:"validationGroupCode"},n(e(s)("groups.form.code")),3),o("div",L,[_(e(V),{name:"code",ref_key:"codeField",ref:y,rules:"required|max:255",class:b(["form-control",{"is-invalid":!w.value}]),type:"text",autocomplete:"off",id:"validationGroupCode","aria-describedby":"validationGroupCodeFeedback"},null,8,["class"]),_(e(O),{name:"code",as:"div",class:"invalid-feedback",id:"validationGroupCodeFeedback"})])]),o("div",Q,[o("label",{class:b(["col-4 col-form-label",{"pb-4":!F.value}]),for:"validationGroupTitle"},n(e(s)("groups.form.title")),3),o("div",W,[_(e(V),{name:"title",ref_key:"titleField",ref:g,rules:"max:255",class:b(["form-control",{"is-invalid":!F.value}]),type:"text",autocomplete:"off",id:"validationGroupTitle","aria-describedby":"validationGroupTitleFeedback"},null,8,["class"]),_(e(O),{name:"title",as:"div",class:"invalid-feedback",id:"validationGroupTitleFeedback"})])]),d.value.length?(x(),G("div",X,n(d.value),1)):S("",!0),t.value.length?(x(),G("div",Y,n(t.value),1)):S("",!0),o("div",K,[o("button",Z,n(e(s)("btn.save")),1),o("button",ee,n(e(s)("btn.cancel")),1)])]),_:1},8,["initial-values"]))}};export{te as default};
