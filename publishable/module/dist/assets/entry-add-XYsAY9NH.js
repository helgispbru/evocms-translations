import{a as C,Q as R,d as q,R as z,S as I,r as f,e as F,i as L,o as b,k as M,h as a,g as k,V as P,A as c,t as o,j as e,m as d,W as x,y as U,z as D,X as V,Y as H,U as J,T as j}from"./index-sLDwdUli.js";const Q={class:"row mb-1 align-items-center"},W={class:"col-8"},X={value:""},Y=["value"],Z={class:"row mb-1 align-items-center"},ee={class:"col-8"},ae={class:"row mb-1 align-items-center"},se={class:"col-8"},te={key:0,class:"alert alert-success px-2 py-1",role:"alert"},oe={key:1,class:"alert alert-warning px-2 py-1",role:"alert"},le={class:"mt-3 text-end"},re={class:"btn btn-primary mx-1",type:"submit"},ne={class:"btn btn-secondary mx-1",type:"reset"},ce={__name:"entry-add",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(G){const{t:l}=C(),K=R("locale"),w=q.useToast(),_=z(G,"modelValue"),u=I(),v=f(""),m=f(""),g=f(null),h=f(null),E=f(null),T=F(()=>{var t,s;return((s=(t=g.value)==null?void 0:t.meta)==null?void 0:s.valid)||!1}),O=F(()=>{var t,s;return((s=(t=h.value)==null?void 0:t.meta)==null?void 0:s.valid)||!1}),S=F(()=>{var t,s;return((s=(t=E.value)==null?void 0:t.meta)==null?void 0:s.valid)||!1});async function N(t){m.value="",v.value="";const s=Object.assign({},u.data,t,{locale:K.value});delete s.groups;const y=`${J}/entries`;try{const r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},p=await fetch(y,r),n=await p.json();if(!p.ok){const B=(n==null?void 0:n.error)||`${p.status} ${p.statusText}`,{errors:i}=n;i.hasOwnProperty("group")&&g.value.setErrors(i.group),i.hasOwnProperty("key")&&h.value.setErrors(i.key),i.hasOwnProperty("value")&&E.value.setErrors(i.value);const $=new Error(B);throw $.status=p.status,$}v.value=n.message||"",m.value=n.error||"",_.value.data={saved:!0},_.value.action="close"}catch(r){throw r.name==="TypeError"?w.error(`${l("toast.errornetwork")} ${r.message}`,j):w.error(`${l("toast.error")} ${r.message}`,j),r}}function A(){m.value="",v.value="",_.value.data={saved:!1},_.value.action="close"}return(t,s)=>(b(),L(e(H),{onSubmit:N,onReset:A,class:"needs-validation",name:"EntryAddForm","initial-values":{group:e(u).data.group,key:e(u).data.key,value:e(u).data.value}},{default:M(()=>[a("div",Q,[a("label",{class:c(["col-4 col-form-label",{"pb-4":!T.value}]),for:"validationEntryGroup"},o(e(l)("entries.form.group")),3),a("div",W,[d(e(x),{name:"group",as:"select",ref_key:"groupField",ref:g,rules:"required",class:c(["form-select",{"is-invalid":!T.value}]),id:"validationEntryGroup","aria-describedby":"validationEntryGroupFeedback"},{default:M(()=>[a("option",X,o(e(l)("entries.form.values.notselected")),1),(b(!0),k(U,null,D(e(u).data.groups,y=>(b(),k("option",{value:y.id,key:y.key},o(y.title),9,Y))),128))]),_:1},8,["class"]),d(e(V),{name:"group",as:"div",class:"invalid-feedback",id:"validationEntryGroupFeedback"})])]),a("div",Z,[a("label",{class:c(["col-4 col-form-label",{"pb-4":!O.value}]),for:"validationEntryKey"},o(e(l)("entries.form.key")),3),a("div",ee,[d(e(x),{name:"key",ref_key:"keyField",ref:h,rules:"required|max:255",class:c(["form-control",{"is-invalid":!O.value}]),type:"text",autocomplete:"off",id:"validationEntryKey","aria-describedby":"validationEntryKeyFeedback"},null,8,["class"]),d(e(V),{name:"key",as:"div",class:"invalid-feedback",id:"validationEntryKeyFeedback"})])]),a("div",ae,[a("label",{class:c(["col-4 col-form-label",{"pb-4":!S.value}]),for:"validationEntryValue"},o(e(l)("entries.form.value")),3),a("div",se,[d(e(x),{name:"value",ref_key:"valueField",ref:E,rules:"max:255",class:c(["form-control",{"is-invalid":!S.value}]),type:"text",autocomplete:"off",id:"validationEntryValue","aria-describedby":"validationEntryValueFeedback"},null,8,["class"]),d(e(V),{name:"value",as:"div",class:"invalid-feedback",id:"validationEntryValueFeedback"})])]),v.value.length?(b(),k("div",te,o(v.value),1)):P("",!0),m.value.length?(b(),k("div",oe,o(m.value),1)):P("",!0),a("div",le,[a("button",re,o(e(l)("btn.save")),1),a("button",ne,o(e(l)("btn.cancel")),1)])]),_:1},8,["initial-values"]))}};export{ce as default};
